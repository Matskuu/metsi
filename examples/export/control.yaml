#Application configuration values. Can be overriden by CLI arguments. May be commented out for None or default from Mela2Configuration.
app_configuration:
  state_format: fdm #options: fdm, vmi12, vmi13, forest_centre
  state_input_container: csv #Only relevant with fdm state_format. Options: pickle, json
  #preprocessing_output_container: csv #options: pickle, json, csv, null, rsd (special case not usable as input container)
  #state_output_container: csv #options: pickle, json, csv, null
  derived_data_output_container: json #options: pickle, json, null
  strategy: partial
  run_modes: preprocess,simulate,postprocess,export

run_constraints:
  thinning_from_above:
    minimum_time_interval: 20
  thinning_from_below:
    minimum_time_interval: 20
  even_thinning:
    minimum_time_interval: 20
  first_thinning:
    minimum_time_interval: 50
  clearcutting:
    minimum_time_interval: 50

operation_params:
  report_volume:
    # Requires R dependency if true
    - lmfor_volume: false
  first_thinning:
    - thinning_factor: 0.97
      e: 0.2
      dominant_height_lower_bound: 11
      dominant_height_upper_bound: 16
  thinning_from_below:
    - thinning_factor: 0.97
      e: 0.2
  thinning_from_above:
    - thinning_factor: 0.98
      e: 0.2
  even_thinning:
    - thinning_factor: 0.9
      e: 0.2
  report_biomass:
    - model_set: 1
  report_collectives:
    - Ftot: reference_trees.stems_per_ha
      Fpine: reference_trees.stems_per_ha[reference_trees.species==1]
      Fbirch: reference_trees.stems_per_ha[(reference_trees.species==3)|(reference_trees.species==4)]
  grow_fhk:
    - package: pymotti_graph
  report_state:
    - stock_vol_pine_log: cross_cutting.volume_per_ha[      (cross_cutting.species==1) & (cross_cutting.timber_grade==1) & (cross_cutting.source == "standing")]
      stock_vol_spruce_log: cross_cutting.volume_per_ha[    (cross_cutting.species==2) & (cross_cutting.timber_grade==1) & (cross_cutting.source == "standing")]
      stock_vol_birch_log: cross_cutting.volume_per_ha[     (cross_cutting.species==3) & (cross_cutting.timber_grade==1) & (cross_cutting.source == "standing")]
      stock_vol_pine_pulp: cross_cutting.volume_per_ha[     (cross_cutting.species==1) & (cross_cutting.timber_grade==2) & (cross_cutting.source == "standing")]
      stock_vol_spruce_pulp: cross_cutting.volume_per_ha[   (cross_cutting.species==2) & (cross_cutting.timber_grade==2) & (cross_cutting.source == "standing")]
      stock_vol_birch_pulp: cross_cutting.volume_per_ha[    (cross_cutting.species==3) & (cross_cutting.timber_grade==2) & (cross_cutting.source == "standing")]
      stock_vol_pine_energy: cross_cutting.volume_per_ha[   (cross_cutting.species==1) & (cross_cutting.timber_grade==3) & (cross_cutting.source == "standing")]
      stock_vol_spruce_energy: cross_cutting.volume_per_ha[ (cross_cutting.species==2) & (cross_cutting.timber_grade==3) & (cross_cutting.source == "standing")]
      stock_vol_birch_energy: cross_cutting.volume_per_ha[  (cross_cutting.species==3) & (cross_cutting.timber_grade==3) & (cross_cutting.source == "standing")]
      timber_vol_pine_log: cross_cutting.volume_per_ha[     (cross_cutting.species==1) & (cross_cutting.timber_grade==1) & (cross_cutting.source == "harvested")]
      timber_vol_spruce_log: cross_cutting.volume_per_ha[   (cross_cutting.species==2) & (cross_cutting.timber_grade==1) & (cross_cutting.source == "harvested")]
      timber_vol_birch_log: cross_cutting.volume_per_ha[    (cross_cutting.species==3) & (cross_cutting.timber_grade==1) & (cross_cutting.source == "harvested")]
      timber_vol_pine_pulp: cross_cutting.volume_per_ha[    (cross_cutting.species==1) & (cross_cutting.timber_grade==2) & (cross_cutting.source == "harvested")]
      timber_vol_spruce_pulp: cross_cutting.volume_per_ha[  (cross_cutting.species==2) & (cross_cutting.timber_grade==2) & (cross_cutting.source == "harvested")]
      timber_vol_birch_pulp: cross_cutting.volume_per_ha[   (cross_cutting.species==3) & (cross_cutting.timber_grade==2) & (cross_cutting.source == "harvested")]
      timber_vol_pine_energy: cross_cutting.volume_per_ha[  (cross_cutting.species==1) & (cross_cutting.timber_grade==3) & (cross_cutting.source == "harvested")]
      timber_vol_spruce_energy: cross_cutting.volume_per_ha[(cross_cutting.species==2) & (cross_cutting.timber_grade==3) & (cross_cutting.source == "harvested")]
      timber_vol_birch_energy: cross_cutting.volume_per_ha[ (cross_cutting.species==3) & (cross_cutting.timber_grade==3) & (cross_cutting.source == "harvested")]


preprocessing_params:
  generate_reference_trees:
    - n_trees: 10
  filter:
    - remove trees: sapling or stems_per_ha == 0
      remove: not reference_trees

preprocessing_operations:
  - generate_reference_trees # comment out if input data contains direct trees (vmi12 or vmi13)
  - filter
  - compute_location_metadata

operation_file_params:
  thinning_from_above:
    thinning_limits: data/parameter_files/Thin.txt
  thinning_from_below:
    thinning_limits: data/parameter_files/Thin.txt
  even_thinning:
    thinning_limits: data/parameter_files/Thin.txt
  clearcutting:
    clearcutting_limits_ages: data/parameter_files/renewal_ages_southernFI.txt  
    clearcutting_limits_diameters: data/parameter_files/renewal_diameters_southernFI.txt 
    clearcutting_instructions: data/parameter_files/clearcut_instructions.txt
  cross_cut_felled_trees:
    timber_price_table: data/parameter_files/timber_price_table.csv
  cross_cut_standing_trees:
    timber_price_table: data/parameter_files/timber_price_table.csv

simulation_events:
  - time_points: [2022, 2027, 2032, 2037, 2042, 2047, 2052, 2057, 2062, 2067] # GROWTH/STATE YEARS
    generators:
      - sequence:
        - grow_fhk
        - cross_cut_standing_trees
        - report_state
  - time_points: [2047, 2067] # EVENT YEARS
    generators:
      - sequence:
        - cross_cut_standing_trees
      - alternatives:
        - do_nothing
        - even_thinning
      - sequence:
        - cross_cut_felled_trees
        - report_state
        - report_collectives


post_processing:
  operation_params:
    do_nothing:
      - param: value

  post_processing:
    - do_nothing

export:
  - format: J
    cda_filename: data.cda
    xda_filename: data.xda
    cvariables:
      - year
      - site_type_category
      - land_use_category
      - soil_peatland_category
    xvariables:
      - Ftot
      - Fpine
      - int(site_type_category < 7) * sum(Fbirch)
  - format: rm_schedules_events_timber

